<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Site Builder Pro - Multipage</title>
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <!-- Application Styles -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <div class="editor">
            <iframe id="previewFrame" style="width: 100%; height: 100%; border: none;"></iframe>
        </div>

        <div class="panel">
            <div class="panel-header">
                <h2 style="margin-bottom: 15px;">Photo Site Builder Pro</h2>
                <div class="button-group">
                    <button class="btn-save" onclick="saveProject()">üíæ Salva</button>
                    <button class="btn-load" onclick="document.getElementById('loadInput').click()">üì§ Carica</button>
                    <input id="loadInput" type="file" accept=".json" onchange="loadProject(event)" />
                    <button class="btn-export" onclick="exportSite()">üì¶ Esporta ZIP</button>
                </div>
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('structure', event)">üìã Struttura</button>
                    <button class="tab" onclick="switchTab('header', event)">üéØ Header</button>
                    <button class="tab" onclick="switchTab('editor', event)">üé® Editor</button>
                    <button class="tab" onclick="switchTab('settings', event)">‚öôÔ∏è Impostazioni</button>
                </div>
            </div>

            <div class="panel-content">
                <!-- TAB STRUTTURA -->
                <div id="structure" class="section active">
                    <h4 style="margin-bottom: 15px;">Struttura Sito</h4>
                    <div class="info-panel">
                        <strong>üí° Suggerimento</strong><br>
                        Crea la struttura del tuo sito aggiungendo pagine.<br>
                        Ogni pagina sar√† un file HTML separato con le immagini in una cartella dedicata.
                    </div>
                    
                    <div id="pagesList"></div>
                    
                    <button class="button-primary" style="background: #4CAF50;" onclick="addPage('normal')">+ Pagina Normale</button>
                    <button class="button-primary" style="background: #9c27b0;" onclick="addPage('gallery')">+ Pagina con Sottopagine</button>
                </div>

                <!-- TAB HEADER -->
                <div id="header" class="section">
                    <h4 style="margin-bottom: 15px;">Header del Sito</h4>
                    <div class="info-panel">
                        <strong>üéØ Header</strong><br>
                        Aggiungi elementi all'header: testo, menu, logo.<br>
                        L'header apparir√† su tutte le pagine del sito.
                    </div>
                    
                    <div id="headerList"></div>
                    
                    <button class="button-primary" style="background: #2196F3;" onclick="addHeaderElement('text')">+ Testo Header</button>
                    <button class="button-primary" style="background: #9c27b0;" onclick="addHeaderElement('menu')">+ Menu con Link</button>
                    <button class="button-primary" style="background: #673AB7;" onclick="addHeaderElement('dropdown')">üìÇ Menu a Tendina</button>
                    <button class="button-primary" style="background: #ff6b6b;" onclick="document.getElementById('headerImageInput').click()">üñºÔ∏è Logo/Immagine</button>
                    <button class="button-primary" style="background: #ff9800;" onclick="document.getElementById('headerImageLinkInput').click()">üîó Immagine con Link</button>
                    <input id="headerImageInput" type="file" accept="image/*" onchange="addHeaderImage(event)" />
                    <input id="headerImageLinkInput" type="file" accept="image/*" onchange="addHeaderImageWithLink(event)" />
                    
                    <div id="headerEditPanel" style="display: none; margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 4px;">
                        <h4 style="margin-bottom: 15px;" id="headerEditTitle">Modifica Elemento</h4>
                        
                        <div class="form-group" id="headerTextGroup">
                            <label>Testo:</label>
                            <input type="text" id="headerEditText" />
                        </div>
                        
                        <div class="form-group" id="headerMenuLinkGroup" style="display:none">
                            <label>Collega a:</label>
                            <select id="headerEditMenuLink"></select>
                        </div>
                        
                        <div class="form-group" id="headerExternalUrlGroup" style="display:none">
                            <label>URL esterno:</label>
                            <input type="url" id="headerEditExternalUrl" placeholder="https://esempio.com" />
                        </div>
                        
                        <div class="form-group" id="headerImageLinkTypeGroup" style="display:none">
                            <label>Tipo di link:</label>
                            <select id="headerEditImageLinkType" onchange="toggleImageLinkFields()">
                                <option value="none">Nessun link</option>
                                <option value="page">Pagina interna</option>
                                <option value="external">Link esterno</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="headerImageLinkPageGroup" style="display:none">
                            <label>Collega a pagina:</label>
                            <select id="headerEditImageLinkPage"></select>
                        </div>
                        
                        <div class="form-group" id="headerImageLinkUrlGroup" style="display:none">
                            <label>URL esterno:</label>
                            <input type="url" id="headerEditImageLinkUrl" placeholder="https://esempio.com" />
                        </div>
                        
                        <div id="headerDropdownGroup" style="display:none">
                            <div class="form-group">
                                <label>Sottomenu:</label>
                                <div id="dropdownItemsList"></div>
                                <button class="button-primary" style="background: #4CAF50; padding: 8px;" onclick="addDropdownItem()">+ Aggiungi Voce</button>
                            </div>
                        </div>
                        
                        <div class="slider-group">
                            <label>Posizione X: <span id="headerEditXValue">50</span>px</label>
                            <input type="range" min="0" max="1200" value="50" id="headerEditX" oninput="document.getElementById('headerEditXValue').textContent=this.value" />
                        </div>
                        
                        <div class="slider-group">
                            <label>Posizione Y: <span id="headerEditYValue">80</span>px</label>
                            <input type="range" min="0" max="400" value="80" id="headerEditY" oninput="document.getElementById('headerEditYValue').textContent=this.value" />
                        </div>
                        
                        <div class="slider-group" id="headerFontSizeGroup">
                            <label>Dimensione: <span id="headerEditFontSizeValue">16</span>px</label>
                            <input type="range" min="12" max="48" value="16" id="headerEditFontSize" oninput="document.getElementById('headerEditFontSizeValue').textContent=this.value" />
                        </div>
                        
                        <div class="form-group" id="headerColorGroup">
                            <label>Colore:</label>
                            <input type="color" value="#ffffff" id="headerEditColor" />
                        </div>
                        
                        <div class="form-group" id="headerImageNameGroup" style="display:none">
                            <label>Nome immagine:</label>
                            <input type="text" id="headerEditImageName" placeholder="es: Logo, Banner..." />
                        </div>
                        
                        <div class="slider-group" id="headerImageWidthGroup" style="display:none">
                            <label>Larghezza: <span id="headerEditWidthValue">100</span>px</label>
                            <input type="range" min="20" max="400" value="100" id="headerEditWidth" oninput="document.getElementById('headerEditWidthValue').textContent=this.value" />
                        </div>
                        
                        <div class="slider-group" id="headerImageHeightGroup" style="display:none">
                            <label>Altezza: <span id="headerEditHeightValue">100</span>px</label>
                            <input type="range" min="20" max="400" value="100" id="headerEditHeight" oninput="document.getElementById('headerEditHeightValue').textContent=this.value" />
                        </div>
                        
                        <button class="button-primary" style="background: #4CAF50;" onclick="saveHeaderEdit()">‚úì Salva</button>
                        <button class="button-primary" style="background: #666;" onclick="cancelHeaderEdit()">‚úï Annulla</button>
                    </div>
                </div>

                <!-- TAB EDITOR -->
                <div id="editor" class="section">
                    <div class="info-panel">
                        <strong id="currentPageName">Seleziona una pagina dalla Struttura</strong>
                    </div>
                    
                    <div id="editorContent" style="display: none;">
                        <div class="form-group" style="margin-bottom: 15px;">
                            <label>üìê Modalit√† Layout:</label>
                            <select id="layoutModeSelect" onchange="changeLayoutMode()">
                                <option value="default">Con Struttura (titolo + canvas)</option>
                                <option value="blank">Canvas Libero (solo canvas)</option>
                            </select>
                        </div>
                        
                        <div class="info-panel" style="margin-bottom: 15px; border-left-color: #2196F3;">
                            <strong>‚ÑπÔ∏è Modalit√† Layout</strong><br>
                            <span id="layoutModeInfo">
                                <strong>Con Struttura:</strong> Header globale + titolo pagina + canvas<br>
                                <strong>Vuota:</strong> Header globale + canvas libero (no titolo pagina)
                            </span>
                        </div>
                        
                        <button class="button-primary" onclick="document.getElementById('photoInput').click()">+ Carica Foto</button>
                        <input id="photoInput" type="file" multiple accept="image/*" onchange="addPhoto(event)" />
                        
                        <button class="button-primary" style="background: #2196F3;" onclick="addTextBox()">+ Aggiungi Testo</button>
                        
                        <div style="margin: 20px 0; padding: 15px; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196F3;">
                            <h4 style="margin-bottom: 10px; color: #1976d2;">üìå Elementi Solo per Questa Pagina</h4>
                            <p style="font-size: 0.9em; color: #555; margin-bottom: 15px;">Questi elementi appariranno SOLO in questa pagina (non globali come l'header)</p>
                            
                            <div id="pageElementsList" style="margin-bottom: 15px;"></div>
                            
                            <button class="button-primary" style="background: #9c27b0;" onclick="addPageTextElement()">üìù Testo Locale</button>
                            <button class="button-primary" style="background: #ff6b6b;" onclick="document.getElementById('pageElementImageInput').click()">üñºÔ∏è Immagine Locale</button>
                            <input id="pageElementImageInput" type="file" accept="image/*" onchange="addPageImageElement(event)" />
                            <button class="button-primary" style="background: #2196F3;" onclick="addPageMenuLink()">üîó Link Locale</button>
                            <button class="button-primary" style="background: #00bcd4;" onclick="addPageImageLink()">üñºÔ∏èüîó Immagine con Link</button>
                            <input id="pageImageLinkInput" type="file" accept="image/*" onchange="addPageImageLinkElement(event)" />
                            <button class="button-primary" style="background: #673ab7;" onclick="addPageDropdown()">üìã Menu a Tendina</button>
                        </div>
                        
                        <div id="blankModeButtons" style="display: none;">
                            <p style="color: #999; font-size: 0.85em; font-style: italic;">Modalit√† blank attiva - usa i pulsanti sopra</p>
                        </div>
                        
                        <button class="button-primary" style="background: #ff9800;" onclick="document.getElementById('pageImageInput').click()">üñºÔ∏è Immagine Sfondo</button>
                        <button class="button-primary" style="background: #f44336;" onclick="removePageBackground()">üóëÔ∏è Rimuovi Sfondo</button>
                        <input id="pageImageInput" type="file" accept="image/*" onchange="addPageBackground(event)" />
                        
                        <button class="button-primary" style="background: #f44336;" onclick="removePageBackground()">üóëÔ∏è Rimuovi Sfondo</button>
                        
                        <div id="selectedInfo"></div>
                        
                        <div class="slider-group" style="margin-top: 20px;">
                            <label>Altezza Canvas: <span id="canvasHeightValue">600</span>px</label>
                            <input type="range" min="300" max="10000" step="100" value="600" id="canvasHeight" oninput="updateCanvasHeight()" />
                        </div>
                        
                        <div class="info-panel" style="margin-top: 15px; border-left-color: #4CAF50;">
                            <strong>üìä Info Pagina</strong><br>
                            <span id="pageSize">Dimensione: 0 KB</span><br>
                            <span id="pageImageCount">Immagini: 0</span>
                        </div>
                    </div>
                </div>

                <!-- TAB IMPOSTAZIONI -->
                <div id="settings" class="section">
                    <h4 style="margin-bottom: 15px;">Impostazioni Globali</h4>
                    
                    <div class="form-group">
                        <label>üé® Tema Predefinito:</label>
                        <select id="themePreset" onchange="applyTheme()">
                            <option value="custom">Personalizzato</option>
                            <option value="dark">Scuro Moderno</option>
                            <option value="light">Chiaro Minimalista</option>
                            <option value="blue">Blu Professionale</option>
                            <option value="warm">Caldo Accogliente</option>
                            <option value="nature">Natura</option>
                            <option value="sunset">Tramonto</option>
                            <option value="minimal">Minimal B&W</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Nome Sito:</label>
                        <input type="text" id="siteName" value="Il mio Sito" />
                    </div>
                    <div class="form-group">
                        <label>Autore:</label>
                        <input type="text" id="author" value="Il tuo nome" />
                    </div>
                    <div class="form-group">
                        <label>Colore Sfondo:</label>
                        <input type="color" id="primaryColor" value="#1a1a1a" onchange="document.getElementById('themePreset').value='custom'" />
                    </div>
                    <div class="form-group">
                        <label>Colore Testo:</label>
                        <input type="color" id="secondaryColor" value="#ffffff" onchange="document.getElementById('themePreset').value='custom'" />
                    </div>
                    <div class="form-group">
                        <label>Colore Accento:</label>
                        <input type="color" id="accentColor" value="#ff6b6b" onchange="document.getElementById('themePreset').value='custom'" />
                    </div>
                    
                    <div class="form-group">
                        <label>üî§ Font del Sito:</label>
                        <select id="fontFamily" onchange="updateSettings()">
                            <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Segoe UI (Default)</option>
                            <option value="Arial, Helvetica, sans-serif">Arial</option>
                            <option value="'Times New Roman', Times, serif">Times New Roman</option>
                            <option value="Georgia, serif">Georgia</option>
                            <option value="'Courier New', Courier, monospace">Courier New</option>
                            <option value="'Comic Sans MS', cursive">Comic Sans</option>
                            <option value="Impact, fantasy">Impact</option>
                            <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
                            <option value="Verdana, sans-serif">Verdana</option>
                            <option value="custom">Font Personalizzato</option>
                        </select>
                    </div>
                    
                    <div id="customFontSection" style="display: none;">
                        <div class="info-panel" style="margin-bottom: 10px;">
                            <strong>üì• Font Personalizzato</strong><br>
                            Carica un file .ttf o .woff del tuo font preferito
                        </div>
                        <button class="button-primary" style="background: #9c27b0;" onclick="document.getElementById('customFontInput').click()">üì§ Carica Font (.ttf/.woff)</button>
                        <input id="customFontInput" type="file" accept=".ttf,.woff,.woff2" style="display:none;" onchange="loadCustomFont(event)" />
                        <div id="customFontName" style="margin-top: 10px; font-size: 0.9em; color: #666;"></div>
                    </div>
                    
                    <div class="slider-group">
                        <label>Altezza Header: <span id="headerHeightValue">200</span>px</label>
                        <input type="range" min="100" max="600" value="200" id="headerHeightInput" oninput="document.getElementById('headerHeightValue').textContent=this.value;data.headerHeight=parseInt(this.value);updatePreview()" />
                    </div>
                    
                    <div class="form-group">
                        <label>üìç Posizione Menu:</label>
                        <select id="headerPosition">
                            <option value="relative">Normale</option>
                            <option value="sticky">Fisso in alto (segue scroll)</option>
                        </select>
                    </div>
                    
                    <button class="button-primary" onclick="updateSettings()">üíæ Salva Impostazioni</button>
                    
                    <div class="success-panel" style="margin-top: 20px;">
                        <strong>üì¶ Struttura Export</strong><br>
                        Il sito verr√† esportato con questa struttura:<br>
                        ‚Ä¢ <strong>index.html</strong> (homepage)<br>
                        ‚Ä¢ <strong>pagina-nome.html</strong> (altre pagine)<br>
                        ‚Ä¢ <strong>images/</strong> (tutte le immagini)<br>
                        ‚Ä¢ <strong>css/style.css</strong> (stili condivisi)
                    </div>
                    
                    <div class="info-panel" style="margin-top: 15px; border-left-color: #ff9800;">
                        <strong>üìä Dimensione Progetto</strong><br>
                        <span id="totalProjectSize">Totale stimato: 0 KB</span><br>
                        <small>Limite GitHub: ~100 MB per file</small><br>
                        <small>Consigliato: sotto 50 MB totali</small>
                    </div>
                    
                    <button class="button-primary" onclick="updateSettings()">üíæ Salva Impostazioni</button>
                    
                    <div id="exportProgress" style="margin-top: 20px; display: none;">
                        <div class="progress-bar" id="progressBar">
                            <div class="progress-fill" id="progressFill">0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Application JavaScript -->
    <script src="js/app.js"></script>
</body>
</html>
